<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Undian & Drag-and-Drop SPOK Challenge v4.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap');
        body { 
            font-family: 'Fredoka', cursive; 
            background: linear-gradient(to right bottom, #fef9c3, #fde68a); 
            min-height: 100vh;
            padding: 20px;
        }

        /* --- Animasi Peserta (untuk Banyak User) --- */
        #participant-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            min-height: 100px;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            border: 2px dashed #f59e0b;
            border-radius: 8px;
            position: relative;
        }
        .participant-card {
            padding: 8px 15px;
            background-color: #3b82f6; 
            color: white;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, opacity 0.5s;
        }
        
        /* Animasi Pengocokan (Shaking) */
        @keyframes subtle-shake {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(2px, -2px) scale(1.02); }
            50% { transform: translate(-2px, 2px) scale(1); }
            75% { transform: translate(-2px, -2px) scale(1.02); }
        }
        .shuffling {
            animation: subtle-shake 0.1s infinite ease-in-out; 
        }

        /* Animasi Kemenangan: Spotlight Reveal */
        .winner-spotlight {
            background-color: #10b981; 
            border: 3px solid #065f46;
            transform: scale(1.15);
            animation: pulse-glow 1s infinite alternate;
            z-index: 10;
        }
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 10px #10b981, 0 0 20px #10b981; }
            100% { box-shadow: 0 0 20px #10b981, 0 0 30px #065f46; }
        }
        /* Confetti Simulation */
        .confetti-effect {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            overflow: hidden;
            pointer-events: none;
        }
        .confetti-piece {
            position: absolute;
            width: 10px; height: 10px;
            background-color: #fcd34d;
            opacity: 0.7;
            animation: fall 3s ease-in infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(400px) rotate(360deg); opacity: 0; }
        }

        /* --- Gaya Drag and Drop SPOK --- */
        .token {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            cursor: grab;
            user-select: none;
            transition: opacity 0.3s;
        }
        .S-color { background-color: #fcd34d; color: #92400e; }
        .P-color { background-color: #6ee7b7; color: #065f46; }
        .O-color { background-color: #fca5a5; color: #991b1b; }
        .K-color { background-color: #93c5fd; color: #1e40af; }
        
        #drop-zone {
            min-height: 80px;
            border: 4px dashed #3b82f6;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            background-color: #eff6ff; 
        }
        #token-bank {
            min-height: 50px;
            border: 2px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            background-color: #f9fafb;
        }
    </style>
</head>
<body>

    <div class="w-full max-w-6xl mx-auto bg-white rounded-3xl shadow-2xl p-8 border-8 border-yellow-400">
        
        <header class="text-center mb-6">
            <h1 class="text-5xl font-extrabold text-yellow-700 leading-tight">
                üé≤ SPOK Draw: Undian & Drag-and-Drop Kuis! üéØ
            </h1>
            <p id="race-message" class="text-xl font-bold mt-2 text-gray-700">Masukkan nama kelompok (dipisahkan koma) untuk memulai.</p>
        </header>

        <div id="setup-section" class="mb-8 p-4 bg-gray-50 rounded-xl border-2 border-gray-200">
             <h3 class="text-2xl font-bold text-gray-700 mb-2">Input Nama Kelompok (Tidak Terbatas):</h3>
            <textarea id="racer-names" rows="2" class="w-full p-2 border-2 rounded-lg text-lg" placeholder="Contoh: Tim Singa, Tim Harimau, Tim Gajah"></textarea>
            <div class="flex justify-end mt-2">
                <button id="setup-button" onclick="setupDraw()" class="px-6 py-2 bg-yellow-600 text-white rounded-full hover:bg-yellow-700 font-bold">
                    SIAPKAN PESERTA
                </button>
            </div>
        </div>

        <div id="draw-area" class="hidden text-center">
            <div id="confetti-container" class="confetti-effect hidden"></div>

            <div id="participant-container" class="mb-6">
                </div>

            <button id="start-draw-button" onclick="startDraw()" class="mb-6 px-8 py-3 bg-red-600 text-white rounded-lg font-extrabold text-xl hover:bg-red-700 transition transform hover:scale-105">
                UNDI SEKARANG! üé∞
            </button>
        </div>

        <div id="challenge-section" class="mt-8 p-8 rounded-3xl border-4 border-indigo-500 text-center hidden">
            <h3 class="text-4xl font-extrabold text-indigo-700 mb-4">
                üèÜ TANTANGAN SPOK D & D untuk <span id="winner-name" class="text-red-600"></span>! 
            </h3>
            
            <p class="text-xl font-medium text-gray-700 mb-4">Susun Kalimat (S, P, O, K) dari kata-kata acak berikut (Tidak harus urut)!</p>
            
            <div class="text-left mb-6">
                <p class="text-lg font-bold text-indigo-700 mb-2">Kalimat Jawaban:</p>
                <div id="drop-zone" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <span class="text-gray-400 italic">Seret kata kunci di sini...</span>
                </div>
            </div>

            <div class="text-left mb-6">
                <p class="text-lg font-bold text-indigo-700 mb-2">Bank Kata Kunci (Acak):</p>
                <div id="token-bank">
                    </div>
            </div>
            
            <button id="check-challenge" onclick="checkAnswer()" class="mt-4 px-6 py-3 bg-indigo-600 text-white rounded-full font-bold text-xl hover:bg-indigo-700 transition">Cek Kualitas SPOK</button>
            
            <div id="feedback-area" class="text-center mt-4 p-3 rounded-lg font-bold text-xl hidden"></div>
        </div>
    </div>

    <script>
        // --- KONFIGURASI BARU (Pasangan Logis) ---
        // Array of Objects, di mana setiap objek adalah satu set SPOK yang LOGIS.
        const KEYWORD_SETS = [
            { S: 'Adik saya', P: 'menulis', O: 'surat', K: 'di kamar tidur.' },
            { S: 'Petani', P: 'menanam', O: 'padi', K: 'di sawah luas.' },
            { S: 'Presiden', P: 'meresmikan', O: 'gedung baru', K: 'tadi pagi.' },
            { S: 'Para siswa', P: 'berdiskusi', O: 'materi sulit', K: 'dengan serius.' },
            { S: 'Koki', P: 'memasak', O: 'sup hangat', K: 'untuk makan malam.' },
            { S: 'Polisi', P: 'menilang', O: 'pengendara', K: 'di jalan raya.' },
            { S: 'Kakek', P: 'membaca', O: 'koran lama', K: 'di teras rumah.' }
        ];

        let participants = [];
        let currentKeywords = [];
        let isDrawing = false;
        let winnerName = null;

        // --- DOM ELEMENTS ---
        const setupSection = document.getElementById('setup-section');
        const drawArea = document.getElementById('draw-area');
        const participantContainer = document.getElementById('participant-container');
        const startDrawButton = document.getElementById('start-draw-button');
        const racerNamesInput = document.getElementById('racer-names');
        const raceMessage = document.getElementById('race-message');
        const challengeSection = document.getElementById('challenge-section');
        const winnerNameEl = document.getElementById('winner-name');
        const dropZone = document.getElementById('drop-zone');
        const tokenBank = document.getElementById('token-bank');
        const checkChallenge = document.getElementById('check-challenge');
        const feedbackArea = document.getElementById('feedback-area');
        const confettiContainer = document.getElementById('confetti-container');


        // =========================================================
        // === LOGIKA GAME (UNDIAN PESERTA) ========================
        // =========================================================

        function setupDraw() {
            const names = racerNamesInput.value.split(',').map(name => name.trim()).filter(name => name);
            
            if (names.length < 2) {
                alert(`Harap masukkan minimal 2 nama peserta (dipisahkan koma)!`);
                return;
            }
            
            participants = names;
            racerNamesInput.disabled = true;
            setupSection.classList.add('hidden');
            drawArea.classList.remove('hidden');
            raceMessage.textContent = `Ada ${participants.length} peserta. Siap diundi!`;
            
            renderParticipants();
        }

        function renderParticipants() {
            participantContainer.innerHTML = '';
            participants.forEach((name, index) => {
                const card = document.createElement('div');
                card.className = 'participant-card';
                card.id = `card-${index}`;
                card.textContent = name;
                participantContainer.appendChild(card);
            });
            startDrawButton.disabled = false;
            startDrawButton.textContent = "UNDI SEKARANG! üé∞";
            challengeSection.classList.add('hidden');
        }

        function startDraw() {
            if (isDrawing) return;
            isDrawing = true;
            startDrawButton.disabled = true;
            startDrawButton.textContent = "SEDANG MENGUNDI...";
            winnerName = null;
            challengeSection.classList.add('hidden');
            confettiContainer.classList.add('hidden'); 
            confettiContainer.innerHTML = ''; 
            
            // 1. Reset visual
            document.querySelectorAll('.participant-card').forEach(card => {
                card.classList.remove('winner-spotlight', 'shuffling');
                card.style.transform = '';
                card.style.opacity = 1;
            });
            
            // 2. Mulai animasi shuffle
            document.querySelectorAll('.participant-card').forEach(card => {
                card.classList.add('shuffling');
            });
            
            // 3. Tentukan pemenang dan hentikan animasi
            const winnerIndex = Math.floor(Math.random() * participants.length);
            winnerName = participants[winnerIndex];
            const winnerCard = document.getElementById(`card-${winnerIndex}`);

            setTimeout(() => {
                // Hentikan shuffle semua kartu
                document.querySelectorAll('.participant-card').forEach(card => {
                    card.classList.remove('shuffling');
                    card.style.animation = 'none';
                    if(card !== winnerCard) {
                        card.style.opacity = 0.5; // Kartu non-pemenang sedikit meredup
                    }
                });

                // Tampilkan pemenang dengan efek dramatis
                winnerCard.classList.remove('opacity-50');
                winnerCard.classList.add('winner-spotlight');
                winnerCard.textContent = `üèÜ ${winnerName} üèÜ`;
                
                // Panggil Confetti
                createConfetti();
                confettiContainer.classList.remove('hidden');

                raceMessage.textContent = `üéâ SELAMAT! ${winnerName} terpilih! LANJUT ke Tantangan SPOK!`;
                
                isDrawing = false;
                startDrawButton.textContent = "UNDI ULANG üîÑ";
                startDrawButton.disabled = false;
                
                // Panggil tantangan SPOK
                showChallenge(winnerName);
            }, 3000); 
        }
        
        // --- FUNGSI CONFETTI (Dramatis) ---
        function createConfetti() {
            const colors = ['#fcd34d', '#6ee7b7', '#fca5a5', '#93c5fd'];
            confettiContainer.innerHTML = '';
            for (let i = 0; i < 50; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = `${Math.random() * 100}%`;
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDuration = `${(Math.random() * 2) + 1.5}s`;
                piece.style.width = `${(Math.random() * 10) + 5}px`;
                piece.style.height = `${(Math.random() * 10) + 5}px`;
                piece.style.animationDelay = `${Math.random() * 0.5}s`;
                confettiContainer.appendChild(piece);
            }
            setTimeout(() => {
                confettiContainer.classList.add('hidden'); // Hapus setelah 3 detik
            }, 3000);
        }

        function resetGame() {
            racerNamesInput.disabled = false;
            setupSection.classList.remove('hidden');
            drawArea.classList.add('hidden');
            challengeSection.classList.add('hidden');
            confettiContainer.classList.add('hidden');
            racerNamesInput.value = "";
            raceMessage.textContent = "Masukkan nama kelompok (dipisahkan koma) untuk memulai.";
            participants = [];
        }


        // =========================================================
        // === LOGIKA TANTANGAN SPOK (DRAG & DROP) =================
        // =========================================================

        function showChallenge(winnerName) {
            winnerNameEl.textContent = winnerName;
            
            // Reset Drop Zone & Bank
            dropZone.innerHTML = '<span class="text-gray-400 italic">Seret kata kunci di sini...</span>';
            tokenBank.innerHTML = '';
            
            checkChallenge.disabled = false;
            feedbackArea.classList.add('hidden');
            challengeSection.classList.remove('hidden');
            
            currentKeywords = [];
            let tokens = [];

            // 1. PILIH SATU SET SPOK LOGIS SECARA ACAK
            const randomIndex = Math.floor(Math.random() * KEYWORD_SETS.length);
            const selectedSet = KEYWORD_SETS[randomIndex];

            // 2. Isi Current Keywords dari set yang dipilih
            for (const role in selectedSet) {
                currentKeywords.push({ 
                    role: role, 
                    word: selectedSet[role] 
                });
                tokens.push({ 
                    role: role, 
                    word: selectedSet[role], 
                    id: role + Math.random() 
                });
            }

            // 3. Acak Urutan Token di Bank (memastikan urutan token di bank tidak SPOK)
            tokens.sort(() => Math.random() - 0.5);

            // 4. Render Token ke Bank
            tokens.forEach(tokenData => {
                const token = document.createElement('div');
                token.id = tokenData.id;
                token.className = `token ${tokenData.role}-color`;
                token.textContent = tokenData.word;
                token.setAttribute('draggable', true);
                token.setAttribute('data-role', tokenData.role);
                token.setAttribute('data-word', tokenData.word);
                token.ondragstart = drag;
                tokenBank.appendChild(token);
            });
        }
        
        // --- DRAG AND DROP HANDLERS ---
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);
            
            if (!draggedElement || draggedElement.parentNode === dropZone) {
                return;
            }

            // Hapus placeholder jika ada
            if (dropZone.querySelector('span.text-gray-400')) {
                dropZone.querySelector('span.text-gray-400').remove();
            }

            // Pindah elemen ke Drop Zone atau reorder di dalamnya
            if (ev.target.id === 'drop-zone') {
                 dropZone.appendChild(draggedElement);
            } else if (ev.target.classList.contains('token') && ev.target.parentNode === dropZone) {
                // Sisipkan sebelum token yang ada (memungkinkan reordering di drop-zone)
                ev.target.parentNode.insertBefore(draggedElement, ev.target);
            } else {
                 dropZone.appendChild(draggedElement);
            }
            draggedElement.ondragstart = drag; 
        }
        
        // --- FUNGSI CEK JAWABAN ---
        function checkAnswer() {
            const tokensInDropZone = Array.from(dropZone.querySelectorAll('.token'));
            checkChallenge.disabled = true;
            
            if (tokensInDropZone.length !== 4) {
                showFeedback("Harap masukkan LENGKAP 4 kata kunci (S, P, O, K)!", 'bg-red-200', 'text-red-800');
                checkChallenge.disabled = false;
                return;
            }

            // Pastikan semua peran (S, P, O, K) ada.
            const rolesInOrder = tokensInDropZone.map(token => token.getAttribute('data-role'));
            const requiredRoles = ['S', 'P', 'O', 'K'];
            const rolesPresent = new Set(rolesInOrder);
            
            if (requiredRoles.some(role => !rolesPresent.has(role))) {
                 showFeedback("Peran SPOK tidak lengkap! Ada yang hilang dari dropzone.", 'bg-red-200', 'text-red-800');
                checkChallenge.disabled = false;
                return;
            }

            const sentence = tokensInDropZone.map(token => token.textContent).join(' ');
            
            // Umpan balik positif (karena kelengkapan dan logika sudah dijamin dari KEYWORD_SETS)
            showFeedback(`‚úÖ KATA KUNCI LENGKAP! Kalimat: "${sentence}". Sekarang, nilai URUTAN dan EJAAN kalimatnya secara MANUAL!`, 'bg-yellow-200', 'text-yellow-800');

            setTimeout(() => {
                const finalVerdict = confirm(`Kalimat yang disusun: "${sentence}"\n\nApakah Kalimat ini Urut dan EJAANNYA Benar?\n\nTekan OK jika Benar (JUARA).`);
                
                if (finalVerdict) {
                    showFinalWinner(winnerNameEl.textContent);
                } else {
                    showFeedback(`‚ùå KALIMAT GAGAL. ${winnerNameEl.textContent} GUGUR!`, 'bg-red-200', 'text-red-800');
                    // Beri kesempatan memperbaiki
                    checkChallenge.disabled = false;
                }
            }, 1500);
        }
        
        
        function showFinalWinner(name) {
             showFeedback(`üî• JUARA UMUM! ${name} Berhak mendapat Poin Penuh!`, 'bg-green-200', 'text-green-800');
             setTimeout(() => {
                 if (confirm("Mulai Game Baru?")) {
                     resetGame();
                 }
             }, 2000);
        }

        function showFeedback(message, bgColor, textColor) {
            feedbackArea.textContent = message;
            feedbackArea.classList.remove('hidden', 'bg-red-200', 'bg-green-200', 'bg-yellow-200', 'text-red-800', 'text-green-800', 'text-yellow-800', 'bg-indigo-200', 'text-indigo-800');
            feedbackArea.classList.add(bgColor, textColor);
        }
    </script>
</body>
</html>